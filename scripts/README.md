# –ú–∏–≥—Ä–∞—Ü–∏—è MySQL ‚Üí PostgreSQL

## üìã –û–±–∑–æ—Ä

–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MySQL (Timeweb) –≤ PostgreSQL (Replit).

## üéØ –ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã

### 1. `migrate-mysql-to-postgres.sh` (–≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç)
–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏:
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ MySQL
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç PostgreSQL
- –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î (Laravel migrations)
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª—è–µ—Ç sequences
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

### 2. `convert-mysql-to-postgres.php`
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç MySQL dump –≤ PostgreSQL —Ñ–æ—Ä–º–∞—Ç:
- –ó–∞–º–µ–Ω—è–µ—Ç backticks –Ω–∞ –∫–∞–≤—ã—á–∫–∏
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è (0/1 ‚Üí FALSE/TRUE)
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞—Ç—ã (0000-00-00 ‚Üí NULL)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç SQL

### 3. `update-sequences.php`
–û–±–Ω–æ–≤–ª—è–µ—Ç auto-increment —Å—á–µ—Ç—á–∏–∫–∏:
- –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–ª–µ–º `id`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç sequence = MAX(id)
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—É—á–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID

### 4. `verify-migration.php`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç foreign key —Å–≤—è–∑–∏
- –í—ã—è–≤–ª—è–µ—Ç –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` –µ—Å—Ç—å MySQL credentials:
```env
MYSQL_DEV_HOST=46.229.214.78
MYSQL_DEV_USERNAME=gen_user2
MYSQL_DEV_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
MYSQL_DEV_DATABASE=armbase-2
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
```env
DATABASE_URL=postgresql://...
DB_CONNECTION=pgsql
```

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd /home/runner/workspace
bash scripts/migrate-mysql-to-postgres.sh
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

```
üîÑ –®–∞–≥ 1: –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ MySQL (Timeweb)
   ‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª /tmp/mysql-to-postgres/mysql_data.sql
   
üîÑ –®–∞–≥ 2: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ PostgreSQL —Ñ–æ—Ä–º–∞—Ç
   ‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª /tmp/mysql-to-postgres/postgres_data.sql
   
üîÑ –®–∞–≥ 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ PostgreSQL —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   ‚îî‚îÄ –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è Laravel migrations
   
üîÑ –®–∞–≥ 4: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
   ‚îî‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ PostgreSQL (Replit)
   
üîÑ –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sequences
   ‚îî‚îÄ –°—á–µ—Ç—á–∏–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
   
üîÑ –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
   ‚îî‚îÄ –û—Ç—á–µ—Ç –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π –∏ —Å–≤—è–∑—è—Ö
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **MySQL –ù–ï –¢–†–û–ì–ê–ï–¢–°–Ø** - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
- **PostgreSQL –û–ß–ò–©–ê–ï–¢–°–Ø** - —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è (migrate:fresh)
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/tmp/mysql-to-postgres/`

## üîç –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ PostgreSQL

–í `.env`:
```env
DB_CONNECTION=pgsql  # –ë—ã–ª–æ: mysql
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
php artisan config:clear
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
```bash
php scripts/verify-migration.php
```

### SQL –∑–∞–ø—Ä–æ—Å—ã
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql $DATABASE_URL

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM entities;
SELECT COUNT(*) FROM images;
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –û—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞.

### –ü—Ä–æ–±–ª–µ–º—ã —Å sequences
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
```bash
php scripts/update-sequences.php
```

### –ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ foreign keys:
```bash
php scripts/verify-migration.php
```

## ‚úÖ –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ MySQL:
```env
DB_CONNECTION=mysql
```

2. PostgreSQL –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:
```bash
php artisan migrate:fresh --force
bash scripts/migrate-mysql-to-postgres.sh
```

MySQL –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏!

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)
- –î–æ—Å—Ç—É–ø –∫ MySQL (firewall Timeweb)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- –õ–æ–≥–∏ Laravel (`storage/logs/laravel.log`)
